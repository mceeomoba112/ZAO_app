
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZAO Chat - Premium Messaging</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- Mobile Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ZAO Chat">
    <meta name="theme-color" content="#667eea">
    <meta name="msapplication-navbutton-color" content="#667eea">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Preload critical resources -->
    <link rel="preload" href="style.css" as="style">
    <link rel="preload" href="script.js" as="script">

    <link href="style.css" rel="stylesheet" type="text/css" />
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Login/Register Page -->
    <div id="auth-container" class="container">
        <div class="glass-card auth-container fade-in">
            <div class="brand-header">
                <div class="brand-logo">ZAO</div>
                <div class="brand-tagline">Premium messaging experience</div>
            </div>

            <div class="auth-tabs">
                <button id="login-tab" class="tab-button active" onclick="showLogin()">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
                <button id="register-tab" class="tab-button" onclick="showRegister()">
                    <i class="fas fa-user-plus"></i> Register
                </button>
            </div>

            <!-- Login Form -->
            <div id="login-form" class="auth-form">
                <h2>Welcome Back</h2>
                <form onsubmit="handleLogin(event)">
                    <div class="input-group">
                        <input type="email" id="login-email" placeholder="Email address" required>
                    </div>
                    <div class="input-group">
                        <input type="password" id="login-password" placeholder="Password" required>
                    </div>
                    <button type="submit" class="auth-button">
                        <i class="fas fa-sign-in-alt"></i> Sign In
                    </button>
                </form>
            </div>

            <!-- Register Form -->
            <div id="register-form" class="auth-form hidden">
                <h2>Join ZAO</h2>
                <form onsubmit="handleRegister(event)">
                    <div class="input-group">
                        <input type="text" id="register-fullname" placeholder="Full Name" required>
                    </div>
                    <div class="input-group">
                        <input type="email" id="register-email" placeholder="Email address" required>
                    </div>
                    <div class="input-group">
                        <input type="tel" id="register-phone" placeholder="Phone Number" required>
                    </div>
                    <div class="input-group">
                        <input type="password" id="register-password" placeholder="Password" required>
                    </div>
                    <div class="input-group">
                        <input type="password" id="register-confirm-password" placeholder="Confirm Password" required>
                    </div>
                    <button type="submit" class="auth-button">
                        <i class="fas fa-user-plus"></i> Create Account
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Chat Interface -->
    <div id="chat-container" class="container hidden">
        <div class="glass-card chat-container fade-in">
            <!-- Sidebar -->
            <div class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <div class="sidebar-title">
                        <i class="fas fa-comments"></i> Conversations
                    </div>
                </div>

                <div class="nav-tabs">
                    <button class="nav-tab active" onclick="showChats()">
                        <i class="fas fa-comments"></i> Chats
                    </button>
                    <button class="nav-tab" onclick="showFriends()">
                        <i class="fas fa-user-friends"></i> Friends
                    </button>
                    <button class="nav-tab" onclick="showFriendRequests()" id="requests-tab">
                        <i class="fas fa-user-clock"></i> Requests
                        <span class="request-count hidden" id="request-count"></span>
                    </button>
                </div>

                <!-- Chats Content (includes both conversations and groups) -->
                <div id="chats-content" class="sidebar-content">

                    <div class="section-header">
                        <h4><i class="fas fa-user"></i> Direct Messages</h4>
                    </div>
                    <div class="user-list" id="user-list">
                        <!-- Chat list will be populated here -->
                    </div>

                    
                </div>

                <!-- Friends Content -->
                <div id="friends-content" class="sidebar-content hidden">
                    <div class="section-header">
                        <h4><i class="fas fa-user-friends"></i> All Friends</h4>
                    </div>
                    <div class="user-list" id="friends-list">
                        <!-- Friends list will be populated here -->
                    </div>
                </div>

                <!-- Friend Requests Content -->
                <div id="friend-requests-content" class="sidebar-content hidden">
                    <div class="section-header">
                        <h4><i class="fas fa-user-plus"></i> Incoming Requests</h4>
                    </div>
                    <div class="user-list" id="friend-requests-list">
                        <!-- Friend requests will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Main Chat Area -->
            <div class="main-chat">
                <div class="chat-header">
                    <div class="chat-title">
                        <button class="icon-button" onclick="toggleSidebar()">
                            <i class="fas fa-bars"></i>
                        </button>
                        <div class="chat-logo">ZAO</div>
                        <div class="conversation-header">
                            <span id="chat-title-text">Select a conversation</span>
                            <button class="icon-button cancel-chat-button hidden" onclick="cancelCurrentChat()" title="Close conversation">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>

                    <div class="user-info">
                        <div class="user-avatar" id="user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="user-details">
                            <div class="user-name" id="user-name"></div>
                            <div class="user-username" id="user-username"></div>
                        </div>
                        <div class="header-buttons">
                            <button class="icon-button" onclick="showAddFriend()" title="Add Friend">
                                <i class="fas fa-user-plus"></i>
                            </button>
                            <button class="icon-button" onclick="showSettings()" title="Settings">
                                <i class="fas fa-cog"></i>
                            </button>
                            <button onclick="handleLogout()" class="logout-button">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </button>
                        </div>
                    </div>
                </div>

                <div class="chat-messages" id="chat-messages">
                    <div class="welcome-message">
                        <div style="text-align: center; padding: 50px; color: rgba(255,255,255,0.6);">
                            <i class="fas fa-comments" style="font-size: 3rem; margin-bottom: 20px;"></i>
                            <h3>Welcome to ZAO</h3>
                            <p>Select a conversation to start chatting</p>
                        </div>
                    </div>
                </div>

                <div class="message-input-container">
                    <div class="input-row">
                        <div class="media-buttons">
                            <button class="media-button" onclick="selectImage()" title="Send Image">
                                <i class="fas fa-image"></i>
                            </button>
                            <button class="media-button" onclick="selectVideo()" title="Send Video">
                                <i class="fas fa-video"></i>
                            </button>
                            <input type="file" id="media-input" accept="image/*,video/*" style="display: none;" onchange="handleMediaUpload(event)">
                        </div>
                        <input type="text" id="message-input" placeholder="Type your message..." onkeypress="handleKeyPress(event)" disabled>
                        <button onclick="sendMessage()" class="send-button" disabled id="send-button">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- User Profile Modal -->
    <div id="user-profile-modal" class="modal hidden">
        <div class="modal-content glass-card">
            <div class="modal-header">
                <h3><i class="fas fa-user"></i> User Profile</h3>
                <button class="close-button" onclick="closeModal('user-profile-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="profile-view">
                    <div class="profile-avatar-large" id="profile-view-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="profile-info">
                        <h3 id="profile-view-name">User Name</h3>
                        <p id="profile-view-username">@username</p>
                        <p id="profile-view-bio">User bio...</p>
                        <p id="profile-view-joined">Joined recently</p>
                    </div>
                    <div class="profile-actions">
                        <button class="block-user-button" id="block-user-btn" onclick="blockUser()">
                            <i class="fas fa-ban"></i> Block User
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    

    <!-- Add Friend Modal -->
    <div id="add-friend-modal" class="modal hidden">
        <div class="modal-content glass-card">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> Add Friend</h3>
                <button class="close-button" onclick="closeModal('add-friend-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <input type="text" id="friend-username" placeholder="Enter ZAO username (e.g., ZAO_000001)">
                </div>
                <button onclick="sendFriendRequest()" class="auth-button">
                    <i class="fas fa-paper-plane"></i> Send Request
                </button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal hidden">
        <div class="modal-content glass-card">
            <div class="modal-header">
                <h3><i class="fas fa-cog"></i> Settings</h3>
                <button class="close-button" onclick="closeModal('settings-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h4>Profile Settings</h4>
                    <div class="profile-picture-section">
                        <div class="current-avatar" id="profile-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="avatar-controls">
                            <input type="file" id="profile-picture-input" accept="image/*" style="display: none;" onchange="handleProfilePictureUpload(event)">
                            <button class="auth-button" onclick="document.getElementById('profile-picture-input').click()">
                                <i class="fas fa-camera"></i> Change Picture
                            </button>
                        </div>
                    </div>
                    <div class="input-group">
                        <label for="settings-username">Your ZAO Username</label>
                        <input type="text" id="settings-username" placeholder="Loading username..." readonly style="background: rgba(0,0,0,0.3); color: #667eea; font-weight: 600; font-family: 'Courier New', monospace;">
                        <small style="color: rgba(255,255,255,0.6); font-size: 12px; margin-top: 5px; display: block;">
                            <i class="fas fa-lock" style="margin-right: 5px;"></i>
                            Your unique ZAO username is automatically generated and cannot be changed. Share this with friends to connect!
                        </small>
                    </div>
                    <div class="input-group">
                        <label for="settings-bio">Bio</label>
                        <input type="text" id="settings-bio" placeholder="Bio">
                    </div>
                    <div class="setting-item">
                        <label>Profile Visibility</label>
                        <select id="profile-visibility">
                            <option value="public">Public</option>
                            <option value="friends">Friends Only</option>
                            <option value="private">Private</option>
                        </select>
                    </div>
                </div>
                <div class="settings-section">
                    <h4>Invite Friends</h4>
                    <div class="invite-friends-section">
                        <div class="input-group">
                            <input type="text" id="invite-username" placeholder="Enter ZAO username (e.g., ZAO_000001)">
                        </div>
                        <button onclick="sendFriendRequestFromSettings()" class="auth-button invite-button">
                            <i class="fas fa-user-plus"></i> Send Friend Request
                        </button>
                    </div>
                </div>
                <div class="settings-section">
                    <h4>Blocked Users</h4>
                    <button onclick="showBlockedUsers()" class="auth-button">
                        <i class="fas fa-ban"></i> View Blocked Users
                    </button>
                </div>
                <div class="settings-section">
                    <h4>Preferences</h4>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="notifications-enabled"> Enable Notifications
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="sound-enabled"> Enable Sounds
                        </label>
                    </div>
                </div>
                <button onclick="saveSettings()" class="auth-button">
                    <i class="fas fa-save"></i> Save Settings
                </button>
            </div>
        </div>
    </div>

    <!-- Blocked Users Modal -->
    <div id="blocked-users-modal" class="modal hidden">
        <div class="modal-content glass-card">
            <div class="modal-header">
                <h3><i class="fas fa-ban"></i> Blocked Users</h3>
                <button class="close-button" onclick="closeModal('blocked-users-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="blocked-users-list" id="blocked-users-list">
                    <!-- Blocked users will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <div id="error-message" class="error-message hidden"></div>
    <script src="script.js"></script>
</body>
</html>
